import matplotlib.pyplot as plt
import numpy as np
import matplotlib.pyplot as plt
from itertools import combinations
from math import inf


def best_linear_combination_xy(xs, ys, lam, k):
    """
    xs, ys: lists (or 1D arrays) of same length n
    lam: lambda in objective x + lam * y
    k: constraint x <= k for the combined point

    Returns:
        best_val: minimal objective value
        best_alphas: list of length n with convex weights
        x_star, y_star: resulting combined point
    """
    xs = list(xs)
    ys = list(ys)
    n = len(xs)
    assert len(ys) == n, "xs and ys must have same length"

    best_val = inf
    best_alphas = None
    best_xy = (None, None)

    # 1) Single-point candidates (alpha_i = 1)
    for i, (x, y) in enumerate(zip(xs, ys)):
        if x <= k:
            val = x + lam * y
            if val < best_val:
                best_val = val
                alphas = [0.0] * n
                alphas[i] = 1.0
                best_alphas = alphas
                best_xy = (x, y)

    # 2) Two-point combinations on boundary x = k
    for (i, (xa, ya)), (j, (xb, yb)) in combinations(enumerate(zip(xs, ys)), 2):
        xa, ya = xa
        xb, yb = xb
        denom = xa - xb
        if denom == 0:
            continue  # cannot solve for alpha

        alpha = (k - xb) / denom  # solve alpha*xa + (1-alpha)*xb = k
        if 0.0 <= alpha <= 1.0:
            x_star = alpha * xa + (1 - alpha) * xb
            if x_star > k + 1e-9:
                continue  # numeric safety
            y_star = alpha * ya + (1 - alpha) * yb
            val = x_star + lam * y_star
            if val < best_val:
                best_val = val
                alphas = [0.0] * n
                alphas[i] = alpha
                alphas[j] = 1 - alpha
                best_alphas = alphas
                best_xy = (x_star, y_star)

    return best_val, best_alphas, best_xy


def pareto_frontier(xs, ys):
    points = sorted(zip(xs, ys))  # sort by x ascending
    frontier = []
    best_y = float('inf')
    for x, y in points:
        if y < best_y:
            frontier.append((x, y))
            best_y = y
    return zip(*frontier)

#x =  [37.38174273858921, 31.57894736842105, 25.423728813559322, 25.423728813559322, 37.24920534011443, 37.38174273858921, 31.57894736842105, 38.01472908995266, 39.02395447326628, 39.10595744680851, 37.24920534011443, 36.32118644067797, 33.79858156028369, 34.729468599033815, 37.38174273858921, 32.644755244755245, 37.24920534011443, 34.559006211180126, 36.32118644067797, 31.677725118483412, 36.32118644067797, 38.17734408145948, 35.91820224719101, 35.9952805453592, 37.24920534011443, 52.88945362134689, 47.69790382244143, 51.1611030478955, 49.450244698205545, 47.72050816696915, 58.05156136528686, 56.32667876588022, 52.20258935083881, 50.682257244534824, 62.317241379310346, 63.213165572574766, 61.491087668243, 59.130237620170504, 59.10047152702212, 61.390583903208835, 63.213165572574766, 60.82257476294676, 64.06969619606842, 64.20478868129875, 85.77635945876946, 62.30183203337566, 62.37676093634149, 62.48340425531915, 62.514420460729184, 62.37676093634149]
#y =  [45.461465785281185, 60.678935361891895, 71.21408920522121, 71.21408920522121, 145.23501555344785, 45.461465785281185, 60.678935361891895, 193.88209066108718, 193.28857792734, 144.83452249260867, 145.23501555344785, 145.4352620838674, 145.9769762529089, 145.77672972248934, 45.461465785281185, 154.10076167549343, 145.23501555344785, 153.63621394922984, 145.4352620838674, 154.33303553862524, 145.4352620838674, 145.03476902302825, 236.70968419388115, 195.06911612858153, 145.23501555344785, 140.6479643218604, 149.23994616183944, 140.6799916545726, 140.7120189872848, 140.74404631999704, 140.55188232372376, 140.58390965643596, 238.08356149713566, 238.97621836282758, 52.012678051130095, 140.45580032558715, 140.48782765829935, 228.86655904500992, 228.89858637772213, 181.59433390313637, 140.45580032558715, 221.19013453953454, 328.1982593778937, 228.86655904500992, 327.8370205072783, 288.1874076871169, 287.96217914365866, 228.89858637772215, 228.86655904500992, 287.96217914365866]

# alpha = 0.1

ox1 =  [5.322294500295683, 5.846394984326019, 8.889959814140399, 8.881316921845292, 8.904527188245636, 5.322294500295683, 5.846394984326019, 8.88875615332331, 5.867890729959695, 8.8722992317357, 4.881912681912682, 8.966764705882353, 4.636785162287481, 4.84904214559387, 8.768866610971875, 5.322294500295683, 5.846394984326019, 8.869374472204486, 8.801796049514943, 8.81784103314041, 8.768866610971875, 8.807801195344448, 4.892811020232458, 4.881912681912682, 8.727272727272727, 5.322294500295683, 5.846394984326019, 8.879787768428985, 8.904527188245636, 8.923552681150321, 4.81710615280595, 8.833180847819458, 4.892811020232458, 4.636785162287481, 4.823003391921061, 5.322294500295683, 5.846394984326019, 12.900885344719327, 6.042095835199284, 8.904527188245636]
oy1 =  [7.360369629401898, 5.07351610410354, 6.6753994025322045, 7.406170532851159, 7.229757167016711, 7.360369629401898, 5.07351610410354, 7.694598603081506, 5.11680506983323, 8.055341606630659, 6.151074810655741, 4.650396412320454, 8.789198936029745, 6.183146831988618, 4.836303508360296, 7.360369629401898, 5.07351610410354, 7.691569326170005, 8.105033727877753, 8.10395210393736, 4.836303508360296, 4.7840589923433035, 6.032929335162524, 6.151074810655741, 4.881768381926439, 7.360369629401898, 5.07351610410354, 7.614435144332553, 7.229757167016711, 7.235614306856904, 6.4866378097669966, 4.534599637581273, 6.032929335162524, 8.789198936029745, 6.484309396734208, 7.360369629401898, 5.07351610410354, 5.7419581813251535, 5.154161531889661, 7.229757167016711]
x1 =[]
y1=[]

for i in range(len(ox1)):
    if 0:
        continue

    x1.append(ox1[i])
    y1.append(oy1[i])

# alpha = 0.5
ox2 =  [5.846394984326019, 5.322294500295683, 6.042095835199284, 5.867890729959695, 12.75678136380761, 8.768866610971875, 4.892811020232458, 4.881912681912682, 8.777917584145959, 4.84904214559387, 5.846394984326019, 5.322294500295683, 8.889959814140399, 12.900885344719327, 6.211374832064487, 4.8631421072365955, 4.8594875900720576, 4.84904214559387, 8.833186231244484, 8.777603019817553, 5.846394984326019, 5.802507836990595, 8.889229881979773, 8.889959814140399, 8.904527188245636, 5.846394984326019, 5.322294500295683, 8.889959814140399, 8.843589099585584, 8.863650634183097, 5.846394984326019, 5.802507836990595, 8.889959814140399, 5.867890729959695, 5.853112404836542, 5.846394984326019, 5.322294500295683, 12.900885344719327, 8.923552681150321, 5.867890729959695]
oy2 =  [5.07351610410354, 7.360369629401898, 5.154161531889661, 5.11680506983323, 5.449660478803577, 4.836303508360296, 6.032929335162524, 6.151074810655741, 4.825630225198906, 6.183146831988618, 5.07351610410354, 7.360369629401898, 6.6753994025322045, 5.7419581813251535, 5.185644284636895, 6.02384818743336, 6.043620717400694, 6.183146831988618, 4.649863406781393, 4.783626632228714, 5.07351610410354, 5.49642838516497, 7.10276320939802, 6.6753994025322045, 7.229757167016711, 5.07351610410354, 7.360369629401898, 6.6753994025322045, 7.401600930843262, 7.372814351677787, 5.07351610410354, 5.49642838516497, 6.6753994025322045, 5.11680506983323, 5.453612169580325, 5.07351610410354, 7.360369629401898, 5.7419581813251535, 7.235614306856904, 5.11680506983323]
x2 =[]
y2=[]
for i in range(len(ox2)):
    if 0:
        continue
    x2.append(ox2[i])
    y2.append(oy2[i])

x3 =[]
y3=[]
# alpha = 1

#ox3 =  [5.846394984326019, 5.802507836990595, 5.961934617107031, 12.937554941604922, 6.112404836542767, 8.785069075451647, 8.777603019817553, 4.8631421072365955, 4.8594875900720576, 5.846394984326019, 5.846394984326019, 12.900885344719327, 12.75678136380761, 8.889959814140399, 5.867890729959695, 5.846394984326019, 8.889959814140399, 12.927131734271004, 12.75678136380761, 6.042095835199284, 5.846394984326019, 6.211374832064487, 12.900885344719327, 6.042095835199284, 12.900885344719327, 8.90438364224772, 8.846748229233741, 4.8631421072365955, 4.8594875900720576, 5.846394984326019, 5.846394984326019, 8.889959814140399, 5.867890729959695, 12.896678387542384, 8.67346204580885, 5.846394984326019, 12.75678136380761, 6.042095835199284, 12.896678387542384, 8.889959814140399]
#oy3 =  [5.07351610410354, 5.49642838516497, 5.105389823099894, 5.482012004492072, 5.16432299486922, 4.609461674185292, 4.783626632228714, 6.02384818743336, 6.043620717400694, 5.07351610410354, 5.07351610410354, 5.7419581813251535, 5.449660478803577, 6.6753994025322045, 5.11680506983323, 5.07351610410354, 6.6753994025322045, 5.788020885314473, 5.449660478803577, 5.154161531889661, 5.07351610410354, 5.185644284636895, 5.7419581813251535, 5.154161531889661, 5.741958181325153, 4.221825075773914, 4.573954833614839, 6.02384818743336, 6.043620717400694, 5.07351610410354, 5.07351610410354, 6.6753994025322045, 5.11680506983323, 5.762723448777219, 6.0386124996620465, 5.07351610410354, 5.449660478803577, 5.154161531889661, 5.762723448777219, 6.6753994025322045]

ox3 =  [5.846394984326019, 12.835410187225804, 6.042095835199284, 12.726328017078991, 12.75678136380761, 5.846394984326019, 8.67346204580885, 12.692044455607183, 12.72497802335803, 12.75678136380761, 5.846394984326019, 5.867890729959695, 8.67346204580885, 8.66943278570572, 6.042095835199284, 5.846394984326019, 9.20653949699717, 12.75678136380761, 12.692044455607183, 5.867890729959695, 5.846394984326019, 5.867890729959695, 12.936458569339457, 12.72497802335803, 6.042095835199284, 8.90438364224772, 8.846748229233741, 6.1513658755038065, 5.846394984326019, 6.042095835199284, 5.846394984326019, 5.961934617107031, 12.936021881984056, 5.867890729959695, 12.75678136380761, 5.846394984326019, 6.211374832064487, 12.726328017078991, 12.692044455607183, 6.112404836542767]
oy3 =  [5.07351610410354, 5.909132342125284, 5.154161531889661, 5.438648047514208, 5.449660478803577, 5.07351610410354, 6.0386124996620465, 5.413757091990212, 5.434562848332985, 5.449660478803577, 5.07351610410354, 5.11680506983323, 6.0386124996620465, 5.991471033951737, 5.154161531889661, 5.07351610410354, 5.005047980945962, 5.449660478803577, 5.413757091990212, 5.11680506983323, 5.07351610410354, 5.11680506983323, 5.909375811357888, 5.434562848332985, 5.154161531889661, 4.221825075773914, 4.573954833614839, 4.863710830184721, 5.07351610410354, 5.154161531889661, 5.07351610410354, 5.105389823099894, 5.546633049697558, 5.11680506983323, 5.449660478803577, 5.07351610410354, 5.185644284636895, 5.438648047514208, 5.413757091990212, 5.16432299486922]

for i in range(len(ox3)):
    if 0:
        continue
    x3.append(ox3[i])
    y3.append(oy3[i])


fig = plt.figure(figsize=(8,6))
c = ["#90C9E7", "#ff7f0e", "#0D6783"]

X = np.concatenate([x1, x2, x3])
Y = np.concatenate([y1, y2, y3])

# ---- Compute the frontier ----
fx1, fy1 = pareto_frontier(x1, y1)
# ---- Plot the frontier curve ----
plt.plot(fx1, fy1, color=c[0], linewidth=1, marker='o', label=r"$\alpha$ = 0.2")
# ---- Compute the frontier ----
fx2, fy2 = pareto_frontier(x2, y2)
# ---- Plot the frontier curve ----
plt.plot(fx2, fy2, color=c[1], linewidth=1, marker='o', label=r"$\alpha$ = 0.4")
# ---- Compute the frontier ----
fx3, fy3 = pareto_frontier(x3, y3)
# ---- Plot the frontier curve ----
plt.plot(fx3, fy3, color=c[2], linewidth=1, marker='o', label=r"$\alpha$ = 8")





# ---- Compute the frontier ----
fx, fy = pareto_frontier(X, Y)
# ---- Plot the frontier curve ----
plt.plot(fx, fy, color='black', linewidth=1.5,linestyle='--',  dashes=(12, 8),label=" overall Frontier")


# **This is the missing line**

plt.scatter(x1, y1, s=20, color=c[0], alpha=0.1, rasterized=True)
plt.scatter(x2, y2, s=20, color=c[1], alpha=0.1, rasterized=True)
plt.scatter(x3, y3, s=20, color=c[2], alpha=0.1, rasterized=True)

plt.xlabel("Time latency (s)", fontsize=14)
plt.ylabel("Energy consumption (J)", fontsize=14)
plt.title("", fontsize=16)
plt.grid(True, linestyle='--', alpha=0.3)

plt.xlim(4, 10)
#totally 60 points......
#plt.ylim(15, 32)

plt.legend(loc="upper right")

plt.tight_layout()
plt.show()
fig.savefig("ablation1_1.pdf", dpi=300)